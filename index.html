<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Card Tracker â€” Multi-Player</title>
  <style>
    /* ===== Dark theme matching earlier look ===== */
    *{box-sizing:border-box}
    :root{
      --bg:#0f1220; --text:#eef1ff; --muted:#9aa1c3;
      --panel:#151936; --panel-border:#2b2f45; --header:#171a2b;
      --card:#0f1430; --card-border:#2b2f45;
      --pill:#0f162f; --pill-border:#2b2f45;
      --needed:#e11d48;   /* red */
      --duplicate:#7c3aed;/* purple */
      --owned:#16a34a;    /* green */
      --gold-bg:#3a2b12;  /* subtle gold */
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:10;background:var(--header);border-bottom:1px solid var(--panel-border);padding:12px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;align-items:center}
    button,select,input{
      font:inherit;padding:8px 10px;border-radius:12px;border:1px solid var(--panel-border);
      background:#1f2340;color:var(--text);cursor:pointer
    }
    button.primary{background:#3d5afe;border-color:#4b6bff;color:#fff}
    button.danger{background:#7a1e1e;border-color:#a33}
    button:active{transform:scale(.98)}
    main{max-width:1200px;margin:0 auto;padding:14px}

    /* 4 decks across (exact), responsive */
    .decks{display:grid;grid-template-columns:repeat(4,minmax(240px,1fr));gap:14px}
    @media (max-width:1100px){.decks{grid-template-columns:repeat(3,minmax(220px,1fr))}}
    @media (max-width:800px){.decks{grid-template-columns:repeat(2,minmax(200px,1fr))}}
    @media (max-width:520px){.decks{grid-template-columns:1fr}}

    .deck{background:var(--panel);border:1px solid var(--panel-border);border-radius:16px;padding:10px}
    .deck-head{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px}
    .deck-name{font-weight:700;font-size:16px;padding:4px 6px;border-radius:8px}
    .deck-name[contenteditable="true"]{outline:2px dashed var(--panel-border)}
    .counts{font-size:12px;color:var(--muted)}

    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .card{background:var(--card); border:1px solid var(--card-border); border-radius:14px;
      min-height:78px; padding:10px; display:flex; flex-direction:column; justify-content:space-between}
    .name{font-size:13px;line-height:1.2}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between}

    /* status pill */
    .pill{font-size:12px; line-height:1; padding:8px 12px; border-radius:999px;
      background:var(--pill); border:1px solid var(--pill-border); min-width:88px; text-align:center}
    .pill.none{opacity:.6}
    .pill.needed{background:rgba(225,29,72,.15); border-color:rgba(225,29,72,.45); color:#fff}
    .pill.duplicate{background:rgba(124,58,237,.15); border-color:rgba(124,58,237,.45); color:#fff}
    .pill.owned{background:rgba(22,163,74,.15); border-color:rgba(22,163,74,.45); color:#fff}

    /* gold toggle */
    .gold-btn{font-size:11px; padding:6px 10px; border-radius:10px; background:#1f2340; border:1px solid var(--panel-border); color:var(--text)}
    .gold{background:var(--gold-bg) !important; border-style:dashed}
    .gold .name::after{content:" ðŸ”’"}

    .right-gap{margin-left:8px}
  </style>
</head>
<body>
  <header>
    <div class="toolbar">
      <!-- Player controls -->
      <label for="playerSel">Player:</label>
      <select id="playerSel" title="Select player"></select>
      <button id="addPlayer">Add Player</button>
      <button id="renamePlayer">Rename</button>
      <button id="deletePlayer" class="danger">Delete</button>

      <!-- List / filter -->
      <select id="listKind">
        <option value="duplicate">Duplicates</option>
        <option value="needed">Needed</option>
      </select>
      <button id="makeList" class="primary">Make List</button>
      <button id="copyList">Copy</button>
      <select id="filterSel" title="Filter">
        <option value="all">Show: All</option>
        <option value="none">Unset (â€”)</option>
        <option value="needed">Needed</option>
        <option value="duplicate">Duplicate</option>
        <option value="owned">Owned</option>
        <option value="gold">Gold (Unsharable)</option>
      </select>
      <button id="resetBtn" class="right-gap">Reset Player</button>
    </div>
  </header>

  <main>
    <div id="decks" class="decks"></div>
  </main>

  <script>
    // ===== Persistence (ON) â€” supports up to ~50 players =====
    const STORAGE_KEY = 'cardTrackerProfiles.v1';
    const MAX_PLAYERS = 50;

    function makeDefaultDecks(){
      const names=["BEACH","VOYAGE","DIVING","BARBECUE","RAFTING","RESORT","CHILL","PATIO","EXTREME","SUNSHINE","PARTY","SPORT","MUSIC","ANIMALS","TRAVEL"];
      return names.map(n=>({name:n, cards:Array.from({length:9},(_,i)=>({name:`Card ${i+1}`, status:"none"}))}));
    }

    function defaultProfiles(){
      return {
        active: 'Julie',            // initial selected player
        players: {
          'Julie': { decks: makeDefaultDecks() }
        }
      };
    }

    function loadProfiles(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        const obj = raw ? JSON.parse(raw) : defaultProfiles();
        if(!obj.active || !obj.players || !obj.players[obj.active]){
          obj.active = Object.keys(obj.players||{'Julie':{decks:makeDefaultDecks()}})[0];
        }
        return obj;
      }catch{
        return defaultProfiles();
      }
    }
    function saveProfiles(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(PROFILES)); }

    let PROFILES = loadProfiles();
    let filter = 'all';

    // Shortcuts for the active player's decks
    function getDecks(){ return PROFILES.players[PROFILES.active].decks; }
    function setDecks(d){ PROFILES.players[PROFILES.active].decks = d; saveProfiles(); }

    const decksEl = document.getElementById('decks');
    const playerSel = document.getElementById('playerSel');

    // Populate player select
    function refreshPlayerSelect(){
      playerSel.innerHTML='';
      Object.keys(PROFILES.players).forEach(name=>{
        const opt=document.createElement('option'); opt.value=name; opt.textContent=name;
        if(name===PROFILES.active) opt.selected=true;
        playerSel.appendChild(opt);
      });
    }

    function countDeck(deck){
      let N=0,O=0,D=0,G=0;
      deck.cards.forEach(c=>{
        if(c.status==='needed') N++;
        else if(c.status==='duplicate') D++;
        else if(c.status==='owned') O++;
        else if(c.status==='gold') G++;
      });
      return {N,O,D,G};
    }
    function cardClass(s){ return s==='gold' ? 'gold' : ''; }
    function pillClass(s){ return s==='gold' ? 'none' : (s==='none'?'none':s); }
    function pillLabel(s){ return s==='needed'?'NEEDED':s==='duplicate'?'DUPLICATE':s==='owned'?'OWNED':'â€”'; }

    function render(){
      const decks = getDecks();
      decksEl.innerHTML='';
      decks.forEach((deck, di)=>{
        const wrap=document.createElement('section'); wrap.className='deck';

        // header
        const head=document.createElement('div'); head.className='deck-head';
        const name=document.createElement('div'); name.className='deck-name'; name.contentEditable='true'; name.textContent=deck.name;
        name.addEventListener('keydown',e=>{ if(e.key==='Enter'){e.preventDefault(); name.blur(); }});
        name.addEventListener('blur',()=>{ decks[di].name=(name.textContent||'').trim()||'Untitled Deck'; setDecks(decks); render(); });
        const {N,O,D,G}=countDeck(deck);
        const counts=document.createElement('div'); counts.className='counts'; counts.textContent=`N:${N} O:${O} D:${D} G:${G}`;
        head.appendChild(name); head.appendChild(counts); wrap.appendChild(head);

        // cards
        const grid=document.createElement('div'); grid.className='cards';
        deck.cards.forEach((card, ci)=>{
          if(filter!=='all' && filter!==card.status) return;

          const cardEl=document.createElement('div'); cardEl.className=`card ${cardClass(card.status)}`;

          const nm=document.createElement('div'); nm.className='name'; nm.contentEditable='true'; nm.textContent=card.name;
          nm.addEventListener('keydown',e=>{ if(e.key==='Enter'){e.preventDefault(); nm.blur(); }});
          nm.addEventListener('blur',()=>{ decks[di].cards[ci].name=(nm.textContent||'').trim()||'Card'; setDecks(decks); });

          const row=document.createElement('div'); row.className='row';

          const pill=document.createElement('button'); pill.className=`pill ${pillClass(card.status)}`;
          pill.title='Cycle Needed â†’ Duplicate â†’ Owned â†’ â€”';
          pill.textContent = pillLabel(card.status);
          pill.addEventListener('click', (e)=>{
            e.stopPropagation();
            if(card.status==='gold') return;
            const order=['needed','duplicate','owned','none'];
            const i=order.indexOf(card.status);
            decks[di].cards[ci].status = order[(i+1)%order.length];
            setDecks(decks);
            render();
          });

          const gold=document.createElement('button'); gold.className='gold-btn';
          gold.textContent = card.status==='gold' ? 'Ungold' : 'Gold';
          gold.title='Toggle Gold (unsharable)';
          gold.addEventListener('click',(e)=>{
            e.stopPropagation();
            decks[di].cards[ci].status = card.status==='gold' ? 'none' : 'gold';
            setDecks(decks);
            render();
          });

          row.appendChild(pill);
          row.appendChild(gold);
          cardEl.appendChild(nm);
          cardEl.appendChild(row);
          grid.appendChild(cardEl);
        });

        wrap.appendChild(grid);
        decksEl.appendChild(wrap);
      });
    }

    // ----- Player actions -----
    playerSel.addEventListener('change', ()=>{
      PROFILES.active = playerSel.value;
      saveProfiles();
      render();
    });

    document.getElementById('addPlayer').addEventListener('click', ()=>{
      const name = prompt('New player name (max 30 chars):','');
      if(!name) return;
      const trimmed = name.trim().slice(0,30);
      if(!trimmed) return;
      const count = Object.keys(PROFILES.players).length;
      if(count >= MAX_PLAYERS){ alert(`Limit reached (${MAX_PLAYERS} players).`); return; }
      if(PROFILES.players[trimmed]){ alert('That name already exists.'); return; }
      PROFILES.players[trimmed] = { decks: makeDefaultDecks() };
      PROFILES.active = trimmed;
      saveProfiles();
      refreshPlayerSelect();
      render();
    });

    document.getElementById('renamePlayer').addEventListener('click', ()=>{
      const current = PROFILES.active;
      const next = prompt('Rename player:', current);
      if(!next || next.trim()===current) return;
      const newName = next.trim().slice(0,30);
      if(PROFILES.players[newName]){ alert('That name already exists.'); return; }
      // move data
      PROFILES.players[newName] = PROFILES.players[current];
      delete PROFILES.players[current];
      PROFILES.active = newName;
      saveProfiles();
      refreshPlayerSelect();
      render();
    });

    document.getElementById('deletePlayer').addEventListener('click', ()=>{
      const names = Object.keys(PROFILES.players);
      if(names.length<=1){ alert('You must keep at least one player.'); return; }
      if(!confirm(`Delete player "${PROFILES.active}"? This cannot be undone.`)) return;
      delete PROFILES.players[PROFILES.active];
      PROFILES.active = Object.keys(PROFILES.players)[0];
      saveProfiles();
      refreshPlayerSelect();
      render();
    });

    // ----- Lists / filter / reset -----
    document.getElementById('filterSel').addEventListener('change', e=>{ filter=e.target.value; render(); });

    document.getElementById('makeList').addEventListener('click', ()=>{
      const kind=document.getElementById('listKind').value;
      const decks = getDecks();
      const lines=[];
      decks.forEach(d=>{
        const items=d.cards.filter(c=>c.status===kind).map(c=>c.name);
        if(items.length) lines.push(`${d.name.toUpperCase()} - ${items.join(', ')}`);
      });
      const text = lines.join('\n');
      if(!text){ alert(`No ${kind}s found for ${PROFILES.active}.`); return; }
      navigator.clipboard.writeText(text).then(()=>alert('Copied list to clipboard')).catch(()=>alert(text));
    });

    document.getElementById('copyList').addEventListener('click', ()=>alert('Click â€œMake Listâ€ â€” it copies automatically.'));

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(!confirm(`Reset decks for ${PROFILES.active}?`)) return;
      setDecks(makeDefaultDecks());
      render();
    });

    // ----- Init -----
    (function init(){
      refreshPlayerSelect();
      render();
    })();
  </script>
</body>
</html>

